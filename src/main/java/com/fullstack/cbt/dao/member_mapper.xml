<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fullstack.cbt.dao.MemberDAO">
<select id="login" resultType="String">
	SELECT mb_id 
		FROM cbt_member
	WHERE  mb_id = #{param1} AND mb_pw = PASSWORD(#{param2})
</select>
<insert id="join" parameterType="hashmap">
	INSERT INTO cbt_member
		(mb_id,mb_name,mb_pw,mb_email)
	VALUES(#{mb_id},#{mb_name},
	PASSWORD(#{mb_pw}),#{mb_email})	
</insert>
<select id="overlayId" parameterType="String" resultType="String">
	SELECT mb_id 
	FROM cbt_member 
	WHERE mb_id=#{chkmb_id}
</select>

<select id="overlayEmail" parameterType="String" resultType="String">
	SELECT mb_email 
	FROM cbt_member 
	WHERE mb_email=#{chkmb_email}
</select>

<select id="findId"  resultType="String">
	SELECT mb_id FROM WHERE mb_id=#{mb_id} AND mb_email=#{mb_email}
</select>

<select id="list" resultType="com.fullstack.cbt.dto.MemberDTO">
	SELECT 	mb_id, mb_name, mb_email,mb_date,mb_grade FROM cbt_member 
		ORDER BY mb_date DESC
</select>
<select id="adminMemberDetail" parameterType="String"
	resultType="com.fullstack.cbt.dto.MemberDTO">
		SELECT * FROM cbt_member WHERE mb_id=#{mb_id}
</select>

<insert id="update" parameterType="hashmap">
	INSERT INTO cbt_member_grade(mb_id,mg_content,mg_date,mg_grade_before,mg_grade_after,mg_id)
		VALUES (#{mb_id},#{mg_content},now(),#{mg_grade_before},#{mg_grade_after},'admin')
</insert>
		
<select id="gradelist" parameterType="String" resultType="com.fullstack.cbt.dto.MemberGradeDTO">
	SELECT * FROM cbt_member_grade WHERE mb_id=#{mb_id}
</select>

<update id="changeGrade" >
	UPDATE cbt_member 
	SET mb_grade = #{param1} 
	WHERE mb_id = #{param2}
</update>

<select id="selectedList"  resultType="com.fullstack.cbt.dto.MemberDTO">
	SELECT * FROM cbt_member 
	WHERE 1 
<if test = "!param1.equals('')  ">
	AND mb_grade = #{param1}
</if>

<if  test = "param2.equals('') and  !param3.equals('')"> 
	AND mb_id LIKE CONCAT ('%',#{param3},'%') 
	OR mb_name LIKE CONCAT ('%',#{param3},'%') 
	OR mb_email LIKE CONCAT ('%',#{param3},'%')
</if>
<if  test = "!param3.equals('')">
	   <if test = "param2.equals('아이디')">
      		AND mb_id LIKE CONCAT ('%',#{param3},'%')
  	 </if>
  	 <if test ="param2.equals('이름')">
    	  	AND mb_name LIKE CONCAT ('%',#{param3},'%')
  	 </if>
	  <if test = "param2.equals('이메일')">
      		AND mb_email LIKE CONCAT ('%',#{param3},'%')
  	 </if>
</if>
</select>

<insert id="myDetail" parameterType ="hashmap">
	INSERT INTO cbt_member(mb_id,mb_name,mb_pw,mb_email)
		VALUES(#{mb_id},#{mb_name},PASSWORD(#{mb_pw}),#{mb_email})	
</insert>

<select id="gradeCheck" resultType="String">
	SELECT mb_grade FROM cbt_member WHERE mb_id = #{param1}
</select>
</mapper>